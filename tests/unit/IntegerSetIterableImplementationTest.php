<?php

declare(strict_types=1);

namespace Smoren\PartialIntersection\Tests\Unit;

use Codeception\Test\Unit;
use Smoren\PartialIntersection\IntegerSetIterableImplementation;
use Smoren\PartialIntersection\Tests\Unit\Fixture\ArrayIteratorFixture;
use Smoren\PartialIntersection\Tests\Unit\Fixture\GeneratorFixture;
use Smoren\PartialIntersection\Tests\Unit\Fixture\IteratorAggregateFixture;

class IntegerSetIterableImplementationTest extends Unit
{
    /**
     * @dataProvider dataProviderForDemo
     * @dataProvider dataProviderForArrays
     * @dataProvider dataProviderForGenerators
     * @dataProvider dataProviderForIterators
     * @dataProvider dataProviderForTraversables
     *
     * @param array $sets
     * @param int $m
     * @param array $expected
     * @return void
     */
    public function testMain(array $sets, int $m, array $expected): void
    {
        // Given
        $result = [];

        // When
        foreach (IntegerSetIterableImplementation::partialIntersection($m, ...$sets) as $value) {
            $result[] = $value;
        }
        sort($result);

        // Then
        $this->assertEquals($expected, $result);
    }

    public function dataProviderForDemo(): array
    {
        return [
            [
                [
                    [1, 2, 3, 4, 5],
                    [1, 2, 10, 11],
                    [1, 2, 3, 12],
                    [1, 4, 13, 14],
                ],
                1,
                [1, 2, 3, 4, 5, 10, 11, 12, 13, 14],
            ],
            [
                [
                    [1, 2, 3, 4, 5],
                    [1, 2, 10, 11],
                    [1, 2, 3, 12],
                    [1, 4, 13, 14],
                ],
                2,
                [1, 2, 3, 4],
            ],
            [
                [
                    [1, 2, 3, 4, 5],
                    [1, 2, 10, 11],
                    [1, 2, 3, 12],
                    [1, 4, 13, 14],
                ],
                3,
                [1, 2],
            ],
            [
                [
                    [1, 2, 3, 4, 5],
                    [1, 2, 10, 11],
                    [1, 2, 3, 12],
                    [1, 4, 13, 14],
                ],
                4,
                [1],
            ],
            [
                [
                    [1, 2, 3, 4, 5],
                    [1, 2, 10, 11],
                    [1, 2, 3, 12],
                    [1, 4, 13, 14],
                ],
                5,
                [],
            ],
        ];
    }

    public function dataProviderForArrays(): array
    {
        return [
            [
                [],
                1,
                [],
            ],
            [
                [],
                2,
                [],
            ],
            [
                [
                    [],
                ],
                1,
                [],
            ],
            [
                [
                    [],
                ],
                2,
                [],
            ],
            [
                [
                    [],
                    [],
                ],
                1,
                [],
            ],
            [
                [
                    [],
                    [],
                ],
                2,
                [],
            ],
            [
                [
                    [],
                    [],
                ],
                3,
                [],
            ],
            [
                [
                    [1, 2, 3],
                    [],
                ],
                1,
                [1, 2, 3],
            ],
            [
                [
                    [1, 2, 3],
                    [],
                ],
                2,
                [],
            ],
            [
                [
                    [1, 2, 3],
                    [],
                ],
                3,
                [],
            ],
            [
                [
                    [1, 2, 3],
                ],
                1,
                [1, 2, 3],
            ],
            [
                [
                    [1, 2, 3],
                ],
                2,
                [],
            ],
            [
                [
                    [1, 2, 3],
                    [2, 3, 4],
                ],
                1,
                [1, 2, 3, 4],
            ],
            [
                [
                    [1, 2, 3],
                    [2, 3, 4],
                ],
                2,
                [2, 3],
            ],
            [
                [
                    [1, 2, 3],
                    [2, 3, 4],
                ],
                3,
                [],
            ],
            [
                [
                    [1, 2, 3, 4, 5],
                    [2, 3, 4, 5, 6],
                    [3, 4, 5, 6, 7],
                ],
                1,
                [1, 2, 3, 4, 5, 6, 7],
            ],
            [
                [
                    [1, 2, 3, 4, 5],
                    [2, 3, 4, 5, 6],
                    [3, 4, 5, 6, 7],
                ],
                2,
                [2, 3, 4, 5, 6],
            ],
            [
                [
                    [1, 2, 3, 4, 5],
                    [2, 3, 4, 5, 6],
                    [3, 4, 5, 6, 7],
                ],
                3,
                [3, 4, 5],
            ],
            [
                [
                    [1, 2, 3, 4, 5],
                    [2, 3, 4, 5, 6],
                    [3, 4, 5, 6, 7],
                ],
                4,
                [],
            ],
            [
                [
                    [1, 2, 3],
                    [2, 3, 4],
                    [5, 6, 7],
                ],
                1,
                [1, 2, 3, 4, 5, 6, 7],
            ],
            [
                [
                    [1, 2, 3],
                    [2, 3, 4],
                    [5, 6, 7],
                ],
                2,
                [2, 3],
            ],
            [
                [
                    [1, 2, 3],
                    [2, 3, 4],
                    [5, 6, 7],
                ],
                3,
                [],
            ],
            [
                [
                    [1, 2, 3],
                    [2, 3, 4],
                    [5, 6, 7],
                ],
                4,
                [],
            ],
            [
                [
                    [1, 2, 3, 4, 5],
                    [1, 3, 5, 7],
                    [3, 4, 5, 6, 7, 8, 9],
                ],
                1,
                [1, 2, 3, 4, 5, 6, 7, 8, 9],
            ],
            [
                [
                    [1, 2, 3, 4, 5],
                    [1, 3, 5, 7],
                    [3, 4, 5, 6, 7, 8, 9],
                ],
                2,
                [1, 3, 4, 5, 7],
            ],
        ];
    }

    public function dataProviderForGenerators(): array
    {
        $gen = fn (array $data) => GeneratorFixture::getGenerator($data);

        return [
            [
                [],
                1,
                [],
            ],
            [
                [],
                2,
                [],
            ],
            [
                [
                    $gen([]),
                ],
                1,
                [],
            ],
            [
                [
                    $gen([]),
                ],
                2,
                [],
            ],
            [
                [
                    $gen([]),
                    $gen([]),
                ],
                1,
                [],
            ],
            [
                [
                    $gen([]),
                    $gen([]),
                ],
                2,
                [],
            ],
            [
                [
                    $gen([]),
                    $gen([]),
                ],
                3,
                [],
            ],
            [
                [
                    $gen([1, 2, 3]),
                    $gen([]),
                ],
                1,
                [1, 2, 3],
            ],
            [
                [
                    $gen([1, 2, 3]),
                    $gen([]),
                ],
                2,
                [],
            ],
            [
                [
                    $gen([1, 2, 3]),
                    $gen([]),
                ],
                3,
                [],
            ],
            [
                [
                    $gen([1, 2, 3]),
                ],
                1,
                [1, 2, 3],
            ],
            [
                [
                    $gen([1, 2, 3]),
                ],
                2,
                [],
            ],
            [
                [
                    $gen([1, 2, 3]),
                    $gen([2, 3, 4]),
                ],
                1,
                [1, 2, 3, 4],
            ],
            [
                [
                    $gen([1, 2, 3]),
                    $gen([2, 3, 4]),
                ],
                2,
                [2, 3],
            ],
            [
                [
                    $gen([1, 2, 3]),
                    $gen([2, 3, 4]),
                ],
                3,
                [],
            ],
            [
                [
                    $gen([1, 2, 3, 4, 5]),
                    $gen([2, 3, 4, 5, 6]),
                    $gen([3, 4, 5, 6, 7]),
                ],
                1,
                [1, 2, 3, 4, 5, 6, 7],
            ],
            [
                [
                    $gen([1, 2, 3, 4, 5]),
                    $gen([2, 3, 4, 5, 6]),
                    $gen([3, 4, 5, 6, 7]),
                ],
                2,
                [2, 3, 4, 5, 6],
            ],
            [
                [
                    $gen([1, 2, 3, 4, 5]),
                    $gen([2, 3, 4, 5, 6]),
                    $gen([3, 4, 5, 6, 7]),
                ],
                3,
                [3, 4, 5],
            ],
            [
                [
                    $gen([1, 2, 3, 4, 5]),
                    $gen([2, 3, 4, 5, 6]),
                    $gen([3, 4, 5, 6, 7]),
                ],
                4,
                [],
            ],
            [
                [
                    $gen([1, 2, 3]),
                    $gen([2, 3, 4]),
                    $gen([5, 6, 7]),
                ],
                1,
                [1, 2, 3, 4, 5, 6, 7],
            ],
            [
                [
                    $gen([1, 2, 3]),
                    $gen([2, 3, 4]),
                    $gen([5, 6, 7]),
                ],
                2,
                [2, 3],
            ],
            [
                [
                    $gen([1, 2, 3]),
                    $gen([2, 3, 4]),
                    $gen([5, 6, 7]),
                ],
                3,
                [],
            ],
            [
                [
                    $gen([1, 2, 3]),
                    $gen([2, 3, 4]),
                    $gen([5, 6, 7]),
                ],
                4,
                [],
            ],
            [
                [
                    $gen([1, 2, 3, 4, 5]),
                    $gen([1, 3, 5, 7]),
                    $gen([3, 4, 5, 6, 7, 8, 9]),
                ],
                1,
                [1, 2, 3, 4, 5, 6, 7, 8, 9],
            ],
            [
                [
                    $gen([1, 2, 3, 4, 5]),
                    $gen([1, 3, 5, 7]),
                    $gen([3, 4, 5, 6, 7, 8, 9]),
                ],
                2,
                [1, 3, 4, 5, 7],
            ],
        ];
    }

    public function dataProviderForIterators(): array
    {
        $iter = fn (array $data) => new ArrayIteratorFixture($data);

        return [
            [
                [],
                1,
                [],
            ],
            [
                [],
                2,
                [],
            ],
            [
                [
                    $iter([]),
                ],
                1,
                [],
            ],
            [
                [
                    $iter([]),
                ],
                2,
                [],
            ],
            [
                [
                    $iter([]),
                    $iter([]),
                ],
                1,
                [],
            ],
            [
                [
                    $iter([]),
                    $iter([]),
                ],
                2,
                [],
            ],
            [
                [
                    $iter([]),
                    $iter([]),
                ],
                3,
                [],
            ],
            [
                [
                    $iter([1, 2, 3]),
                    $iter([]),
                ],
                1,
                [1, 2, 3],
            ],
            [
                [
                    $iter([1, 2, 3]),
                    $iter([]),
                ],
                2,
                [],
            ],
            [
                [
                    $iter([1, 2, 3]),
                    $iter([]),
                ],
                3,
                [],
            ],
            [
                [
                    $iter([1, 2, 3]),
                ],
                1,
                [1, 2, 3],
            ],
            [
                [
                    $iter([1, 2, 3]),
                ],
                2,
                [],
            ],
            [
                [
                    $iter([1, 2, 3]),
                    $iter([2, 3, 4]),
                ],
                1,
                [1, 2, 3, 4],
            ],
            [
                [
                    $iter([1, 2, 3]),
                    $iter([2, 3, 4]),
                ],
                2,
                [2, 3],
            ],
            [
                [
                    $iter([1, 2, 3]),
                    $iter([2, 3, 4]),
                ],
                3,
                [],
            ],
            [
                [
                    $iter([1, 2, 3, 4, 5]),
                    $iter([2, 3, 4, 5, 6]),
                    $iter([3, 4, 5, 6, 7]),
                ],
                1,
                [1, 2, 3, 4, 5, 6, 7],
            ],
            [
                [
                    $iter([1, 2, 3, 4, 5]),
                    $iter([2, 3, 4, 5, 6]),
                    $iter([3, 4, 5, 6, 7]),
                ],
                2,
                [2, 3, 4, 5, 6],
            ],
            [
                [
                    $iter([1, 2, 3, 4, 5]),
                    $iter([2, 3, 4, 5, 6]),
                    $iter([3, 4, 5, 6, 7]),
                ],
                3,
                [3, 4, 5],
            ],
            [
                [
                    $iter([1, 2, 3, 4, 5]),
                    $iter([2, 3, 4, 5, 6]),
                    $iter([3, 4, 5, 6, 7]),
                ],
                4,
                [],
            ],
            [
                [
                    $iter([1, 2, 3]),
                    $iter([2, 3, 4]),
                    $iter([5, 6, 7]),
                ],
                1,
                [1, 2, 3, 4, 5, 6, 7],
            ],
            [
                [
                    $iter([1, 2, 3]),
                    $iter([2, 3, 4]),
                    $iter([5, 6, 7]),
                ],
                2,
                [2, 3],
            ],
            [
                [
                    $iter([1, 2, 3]),
                    $iter([2, 3, 4]),
                    $iter([5, 6, 7]),
                ],
                3,
                [],
            ],
            [
                [
                    $iter([1, 2, 3]),
                    $iter([2, 3, 4]),
                    $iter([5, 6, 7]),
                ],
                4,
                [],
            ],
            [
                [
                    $iter([1, 2, 3, 4, 5]),
                    $iter([1, 3, 5, 7]),
                    $iter([3, 4, 5, 6, 7, 8, 9]),
                ],
                1,
                [1, 2, 3, 4, 5, 6, 7, 8, 9],
            ],
            [
                [
                    $iter([1, 2, 3, 4, 5]),
                    $iter([1, 3, 5, 7]),
                    $iter([3, 4, 5, 6, 7, 8, 9]),
                ],
                2,
                [1, 3, 4, 5, 7],
            ],
        ];
    }

    public function dataProviderForTraversables(): array
    {
        $trav = fn (array $data) => new IteratorAggregateFixture($data);

        return [
            [
                [],
                1,
                [],
            ],
            [
                [],
                2,
                [],
            ],
            [
                [
                    $trav([]),
                ],
                1,
                [],
            ],
            [
                [
                    $trav([]),
                ],
                2,
                [],
            ],
            [
                [
                    $trav([]),
                    $trav([]),
                ],
                1,
                [],
            ],
            [
                [
                    $trav([]),
                    $trav([]),
                ],
                2,
                [],
            ],
            [
                [
                    $trav([]),
                    $trav([]),
                ],
                3,
                [],
            ],
            [
                [
                    $trav([1, 2, 3]),
                    $trav([]),
                ],
                1,
                [1, 2, 3],
            ],
            [
                [
                    $trav([1, 2, 3]),
                    $trav([]),
                ],
                2,
                [],
            ],
            [
                [
                    $trav([1, 2, 3]),
                    $trav([]),
                ],
                3,
                [],
            ],
            [
                [
                    $trav([1, 2, 3]),
                ],
                1,
                [1, 2, 3],
            ],
            [
                [
                    $trav([1, 2, 3]),
                ],
                2,
                [],
            ],
            [
                [
                    $trav([1, 2, 3]),
                    $trav([2, 3, 4]),
                ],
                1,
                [1, 2, 3, 4],
            ],
            [
                [
                    $trav([1, 2, 3]),
                    $trav([2, 3, 4]),
                ],
                2,
                [2, 3],
            ],
            [
                [
                    $trav([1, 2, 3]),
                    $trav([2, 3, 4]),
                ],
                3,
                [],
            ],
            [
                [
                    $trav([1, 2, 3, 4, 5]),
                    $trav([2, 3, 4, 5, 6]),
                    $trav([3, 4, 5, 6, 7]),
                ],
                1,
                [1, 2, 3, 4, 5, 6, 7],
            ],
            [
                [
                    $trav([1, 2, 3, 4, 5]),
                    $trav([2, 3, 4, 5, 6]),
                    $trav([3, 4, 5, 6, 7]),
                ],
                2,
                [2, 3, 4, 5, 6],
            ],
            [
                [
                    $trav([1, 2, 3, 4, 5]),
                    $trav([2, 3, 4, 5, 6]),
                    $trav([3, 4, 5, 6, 7]),
                ],
                3,
                [3, 4, 5],
            ],
            [
                [
                    $trav([1, 2, 3, 4, 5]),
                    $trav([2, 3, 4, 5, 6]),
                    $trav([3, 4, 5, 6, 7]),
                ],
                4,
                [],
            ],
            [
                [
                    $trav([1, 2, 3]),
                    $trav([2, 3, 4]),
                    $trav([5, 6, 7]),
                ],
                1,
                [1, 2, 3, 4, 5, 6, 7],
            ],
            [
                [
                    $trav([1, 2, 3]),
                    $trav([2, 3, 4]),
                    $trav([5, 6, 7]),
                ],
                2,
                [2, 3],
            ],
            [
                [
                    $trav([1, 2, 3]),
                    $trav([2, 3, 4]),
                    $trav([5, 6, 7]),
                ],
                3,
                [],
            ],
            [
                [
                    $trav([1, 2, 3]),
                    $trav([2, 3, 4]),
                    $trav([5, 6, 7]),
                ],
                4,
                [],
            ],
            [
                [
                    $trav([1, 2, 3, 4, 5]),
                    $trav([1, 3, 5, 7]),
                    $trav([3, 4, 5, 6, 7, 8, 9]),
                ],
                1,
                [1, 2, 3, 4, 5, 6, 7, 8, 9],
            ],
            [
                [
                    $trav([1, 2, 3, 4, 5]),
                    $trav([1, 3, 5, 7]),
                    $trav([3, 4, 5, 6, 7, 8, 9]),
                ],
                2,
                [1, 3, 4, 5, 7],
            ],
        ];
    }
}
